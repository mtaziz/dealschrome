function LatLon(a,b,c){if(typeof c=="undefined")c=6371;this._lat=typeof a=="number"?a:typeof a=="string"&&a.trim()!=""?+a:NaN;this._lon=typeof b=="number"?b:typeof b=="string"&&b.trim()!=""?+b:NaN;this._radius=typeof c=="number"?c:typeof c=="string"&&trim(b)!=""?+c:NaN}LatLon.prototype.distanceTo=function(a,b){if(typeof b=="undefined")b=4;var c=this._radius;var d=this._lat.toRad(),e=this._lon.toRad();var f=a._lat.toRad(),g=a._lon.toRad();var h=f-d;var i=g-e;var j=Math.sin(h/2)*Math.sin(h/2)+Math.cos(d)*Math.cos(f)*Math.sin(i/2)*Math.sin(i/2);var k=2*Math.atan2(Math.sqrt(j),Math.sqrt(1-j));var l=c*k;return l.toPrecisionFixed(b)};LatLon.prototype.bearingTo=function(a){var b=this._lat.toRad(),c=a._lat.toRad();var d=(a._lon-this._lon).toRad();var e=Math.sin(d)*Math.cos(c);var f=Math.cos(b)*Math.sin(c)-Math.sin(b)*Math.cos(c)*Math.cos(d);var g=Math.atan2(e,f);return(g.toDeg()+360)%360};LatLon.prototype.finalBearingTo=function(a){var b=a._lat.toRad(),c=this._lat.toRad();var d=(this._lon-a._lon).toRad();var e=Math.sin(d)*Math.cos(c);var f=Math.cos(b)*Math.sin(c)-Math.sin(b)*Math.cos(c)*Math.cos(d);var g=Math.atan2(e,f);return(g.toDeg()+180)%360};LatLon.prototype.midpointTo=function(a){lat1=this._lat.toRad(),lon1=this._lon.toRad();lat2=a._lat.toRad();var b=(a._lon-this._lon).toRad();var c=Math.cos(lat2)*Math.cos(b);var d=Math.cos(lat2)*Math.sin(b);lat3=Math.atan2(Math.sin(lat1)+Math.sin(lat2),Math.sqrt((Math.cos(lat1)+c)*(Math.cos(lat1)+c)+d*d));lon3=lon1+Math.atan2(d,Math.cos(lat1)+c);lon3=(lon3+3*Math.PI)%(2*Math.PI)-Math.PI;return new LatLon(lat3.toDeg(),lon3.toDeg())};LatLon.prototype.destinationPoint=function(a,b){b=typeof b=="number"?b:typeof b=="string"&&b.trim()!=""?+b:NaN;b=b/this._radius;a=a.toRad();var c=this._lat.toRad(),d=this._lon.toRad();var e=Math.asin(Math.sin(c)*Math.cos(b)+Math.cos(c)*Math.sin(b)*Math.cos(a));var f=d+Math.atan2(Math.sin(a)*Math.sin(b)*Math.cos(c),Math.cos(b)-Math.sin(c)*Math.sin(e));f=(f+3*Math.PI)%(2*Math.PI)-Math.PI;return new LatLon(e.toDeg(),f.toDeg())};LatLon.intersection=function(a,b,c,d){b=typeof b=="number"?b:typeof b=="string"&&trim(b)!=""?+b:NaN;d=typeof d=="number"?d:typeof d=="string"&&trim(d)!=""?+d:NaN;lat1=a._lat.toRad(),lon1=a._lon.toRad();lat2=c._lat.toRad(),lon2=c._lon.toRad();brng13=b.toRad(),brng23=d.toRad();dLat=lat2-lat1,dLon=lon2-lon1;dist12=2*Math.asin(Math.sqrt(Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)*Math.sin(dLon/2)));if(dist12==0)return null;brngA=Math.acos((Math.sin(lat2)-Math.sin(lat1)*Math.cos(dist12))/(Math.sin(dist12)*Math.cos(lat1)));if(isNaN(brngA))brngA=0;brngB=Math.acos((Math.sin(lat1)-Math.sin(lat2)*Math.cos(dist12))/(Math.sin(dist12)*Math.cos(lat2)));if(Math.sin(lon2-lon1)>0){brng12=brngA;brng21=2*Math.PI-brngB}else{brng12=2*Math.PI-brngA;brng21=brngB}alpha1=(brng13-brng12+Math.PI)%(2*Math.PI)-Math.PI;alpha2=(brng21-brng23+Math.PI)%(2*Math.PI)-Math.PI;if(Math.sin(alpha1)==0&&Math.sin(alpha2)==0)return null;if(Math.sin(alpha1)*Math.sin(alpha2)<0)return null;alpha3=Math.acos(-Math.cos(alpha1)*Math.cos(alpha2)+Math.sin(alpha1)*Math.sin(alpha2)*Math.cos(dist12));dist13=Math.atan2(Math.sin(dist12)*Math.sin(alpha1)*Math.sin(alpha2),Math.cos(alpha2)+Math.cos(alpha1)*Math.cos(alpha3));lat3=Math.asin(Math.sin(lat1)*Math.cos(dist13)+Math.cos(lat1)*Math.sin(dist13)*Math.cos(brng13));dLon13=Math.atan2(Math.sin(brng13)*Math.sin(dist13)*Math.cos(lat1),Math.cos(dist13)-Math.sin(lat1)*Math.sin(lat3));lon3=lon1+dLon13;lon3=(lon3+3*Math.PI)%(2*Math.PI)-Math.PI;return new LatLon(lat3.toDeg(),lon3.toDeg())};LatLon.prototype.rhumbDistanceTo=function(a){var b=this._radius;var c=this._lat.toRad(),d=a._lat.toRad();var e=(a._lat-this._lat).toRad();var f=Math.abs(a._lon-this._lon).toRad();var g=Math.log(Math.tan(d/2+Math.PI/4)/Math.tan(c/2+Math.PI/4));var h=!isNaN(e/g)?e/g:Math.cos(c);if(f>Math.PI)f=2*Math.PI-f;var i=Math.sqrt(e*e+h*h*f*f)*b;return i.toPrecisionFixed(4)};LatLon.prototype.rhumbBearingTo=function(a){var b=this._lat.toRad(),c=a._lat.toRad();var d=(a._lon-this._lon).toRad();var e=Math.log(Math.tan(c/2+Math.PI/4)/Math.tan(b/2+Math.PI/4));if(Math.abs(d)>Math.PI)d=d>0?-(2*Math.PI-d):2*Math.PI+d;var f=Math.atan2(d,e);return(f.toDeg()+360)%360};LatLon.prototype.rhumbDestinationPoint=function(a,b){var c=this._radius;var d=parseFloat(b)/c;var e=this._lat.toRad(),f=this._lon.toRad();a=a.toRad();var g=e+d*Math.cos(a);var h=g-e;var i=Math.log(Math.tan(g/2+Math.PI/4)/Math.tan(e/2+Math.PI/4));var j=!isNaN(h/i)?h/i:Math.cos(e);var k=d*Math.sin(a)/j;if(Math.abs(g)>Math.PI/2)g=g>0?Math.PI-g:-(Math.PI-g);lon2=(f+k+3*Math.PI)%(2*Math.PI)-Math.PI;return new LatLon(g.toDeg(),lon2.toDeg())};LatLon.prototype.lat=function(a,b){if(typeof a=="undefined")return this._lat;return Geo.toLat(this._lat,a,b)};LatLon.prototype.lon=function(a,b){if(typeof a=="undefined")return this._lon;return Geo.toLon(this._lon,a,b)};LatLon.prototype.toString=function(a,b){if(typeof a=="undefined")a="dms";if(isNaN(this._lat)||isNaN(this._lon))return"-,-";return Geo.toLat(this._lat,a,b)+", "+Geo.toLon(this._lon,a,b)};if(typeof Number.prototype.toRad==="undefined"){Number.prototype.toRad=function(){return this*Math.PI/180}}if(typeof Number.prototype.toDeg==="undefined"){Number.prototype.toDeg=function(){return this*180/Math.PI}}if(typeof Number.prototype.toPrecisionFixed==="undefined"){Number.prototype.toPrecisionFixed=function(a){if(isNaN(this))return"NaN";var b=this<0?-this:this;var c=this<0?"-":"";if(b==0){var d="0.";while(a--)d+="0";return d}var e=Math.ceil(Math.log(b)*Math.LOG10E);var d=String(Math.round(b*Math.pow(10,a-e)));if(e>0){l=e-d.length;while(l-->0)d=d+"0";if(e<d.length)d=d.slice(0,e)+"."+d.slice(e)}else{while(e++<0)d="0"+d;d="0."+d}return c+d}}if(typeof String.prototype.trim==="undefined"){String.prototype.trim=function(){return String(this).replace(/^\s\s*/,"").replace(/\s\s*$/,"")}}
(function(a){function r(){var a=1.29991;var b=103.849426;map.setCenter(new google.maps.LatLng(a,b));map.setZoom(14)}function q(){map.setCenter(new google.maps.LatLng(i,j));map.setZoom(14)}function p(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(a){i=a.coords.latitude;j=a.coords.longitude;q();h=new google.maps.Marker({position:new google.maps.LatLng(i,j),map:map,icon:userLocationIcon,draggable:false,animation:google.maps.Animation.DROP,zIndex:999});var b=new google.maps.InfoWindow({content:"You are here"});google.maps.event.addListener(h,"mouseover",function(){b.open(map,h)});google.maps.event.addListener(h,"mouseout",function(){b.close()})},function(){})}}function o(a){return new google.maps.LatLng(a.split(",")[0],a.split(",")[1])}function n(a,b){if(!b){switch(a){case"Eateries":iconImage=foodIcon;break;case"Beauty & Wellness":iconImage=beautyIcon;break;case"Travel":iconImage=travelIcon;break;case"Fun & Activities":iconImage=funIcon;break;case"Services & Others":iconImage=servicesIcon;break;case"Goods":iconImage=shoppingIcon;break}}else{switch(a){case"Eateries":iconImage=foodDarkIcon;break;case"Beauty & Wellness":iconImage=beautyDarkIcon;break;case"Travel":iconImage=travelDarkIcon;break;case"Fun & Activities":iconImage=funDarkIcon;break;case"Services & Others":iconImage=servicesDarkIcon;break;case"Goods":iconImage=shoppingDarkIcon;break}}return iconImage}function m(b){function g(b){var c=b.bought+" sold";var d="$"+b.price.toFixed(2);var e="$"+b.worth.toFixed(2);var f=b.discount+"%";var g=Math.round((new Date).getTime()/1e3);var h=b.expiry-g;var i=Math.floor(h/60%60);var j=Math.floor(h/3600)%100;var k=j+"h"+i+"m";a(".mapdeal-url").attr("href",b.url);a(".mapdeal-imgsrc").attr("src",b.imgsrc);a(".mapdeal-title").html(b.title);a(".gmap_after_price").html(d);a(".gmap_original_price").html(e);a(".gmap_branch").html(b.dealsource);a(".gmap_branch_link").attr("href","http://"+b.dealsource);a(".gmap_time_left_span").html(k);a("#gmap_deals_div").fadeIn(1e3);if(parseInt(b.bought)!=0){a(".gmap_sold_number").html(c)}else{a(".gmap_sold_number").html("")}}function d(a){var b=a.location;if(!e[b]){e[b]=new google.maps.Marker({position:o(b),map:map,icon:new google.maps.MarkerImage(n(a.category)),draggable:false,animation:google.maps.Animation.DROP,coords:b,deal:a});google.maps.event.addListener(e[b],"click",function(a){if(f){f.setIcon(new google.maps.MarkerImage(n(f.deal.category,true)));f.setAnimation(null)}f=this;g(this.deal);this.setAnimation(google.maps.Animation.BOUNCE)})}}if(b.numFound==0){a("#changecenter_dialogue").html(a("#changecenter_dialogue_content")[0])}else{a("#changecenter_dialogue").html("")}for(var c=0;c<b.numFound;c++){d(b.docs[c])}}function l(){b=map.getBounds();c=map.getCenter();d=function(){var a=new LatLon(b.getNorthEast().lat(),b.getNorthEast().lng());var c=new LatLon(b.getCenter().lat(),b.getCenter().lng());return a.distanceTo(c)}();var e={r:"deal/search/locationdeals",radius:d,center:c.lat()+","+c.lng()};a.get("",e,m,"json")}function k(){var a={zoom:14,center:new google.maps.LatLng(i,j),mapTypeControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map_canvas"),a);p();var b;google.maps.event.addListener(map,"bounds_changed",function(){clearTimeout(b);b=setTimeout(function(){l()},1e3)})}var b;var c;var d;var e={};var f;var g;var h;var i=1.29991;var j=103.849426;a(document).ready(function(){var a=document.createElement("script");a.type="text/javascript";a.src="http://maps.googleapis.com/maps/api/js?key=AIzaSyA3rRFHFRuCY_c7M5v7MpYtDtL7h0fElUg&sensor=true&callback=rungmap";document.body.appendChild(a)});window.rungmap=k;window.focusToDealZone=r})(jQuery)